{% extends 'base.html' %}
{% load static %}

{% block title %}Eventos - PRCE{% endblock %}

{% block page_title %}
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
    <h1>Gesti√≥n de Eventos</h1>
    {% if user.puede_gestionar_eventos %}
    <a href="{% url 'eventos:crear' %}" class="btn btn-primary">
        + Crear Nuevo Evento
    </a>
    {% endif %}
</div>
{% endblock %}

{% block content %}
<div class="card">
    <div class="card-body">
        {% if eventos %}
        <div style="display: grid; gap: 1.5rem;">
            {% for evento in eventos %}
            <div class="card" style="margin-bottom: 0;">
                <div class="card-body">
                    <div style="display: grid; grid-template-columns: auto 1fr auto; gap: 1.5rem; align-items: start;">
                        <!-- Imagen del evento -->
                        <div style="width: 200px; height: 120px; overflow: hidden; background-color: #e0e0e0; display: flex; align-items: center; justify-content: center;">
                            {% if evento.imagen_banner %}
                                <img src="{{ evento.imagen_banner.url }}" alt="{{ evento.nombre }}" style="width: 100%; height: 100%; object-fit: cover;">
                            {% else %}
                                <span style="color: #6c757d; font-size: 3rem;">üìÖ</span>
                            {% endif %}
                        </div>
                        
                        <!-- Informaci√≥n del evento -->
                        <div>
                            <div style="display: flex; gap: 0.5rem; margin-bottom: 0.5rem; flex-wrap: wrap;">
                                <span class="badge badge-info">{{ evento.tipo_evento }}</span>
                                
                                {% if evento.estado == 'BORRADOR' %}
                                    <span class="badge badge-secondary">{{ evento.get_estado_display }}</span>
                                {% elif evento.estado == 'PUBLICADO' %}
                                    <span class="badge badge-success">{{ evento.get_estado_display }}</span>
                                {% elif evento.estado == 'EN_CURSO' %}
                                    <span class="badge badge-warning">{{ evento.get_estado_display }}</span>
                                {% elif evento.estado == 'FINALIZADO' %}
                                    <span class="badge" style="background-color: #95a5a6; color: white;">{{ evento.get_estado_display }}</span>
                                {% elif evento.estado == 'CANCELADO' %}
                                    <span class="badge badge-danger">{{ evento.get_estado_display }}</span>
                                {% endif %}
                                
                                {% if evento.esta_lleno %}
                                    <span class="badge badge-danger">LLENO</span>
                                {% endif %}
                                
                                {% if evento.es_gratuito %}
                                    <span class="badge badge-success">GRATUITO</span>
                                {% endif %}
                            </div>
                            
                            <h3 style="margin: 0.5rem 0;">
                                <a href="{% url 'eventos:detalle' evento.pk %}">{{ evento.nombre }}</a>
                            </h3>
                            
                            <p style="color: #6c757d; margin: 0.5rem 0;">
                                {{ evento.descripcion|truncatewords:30 }}
                            </p>
                            
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 0.5rem; margin-top: 1rem; font-size: 0.875rem;">
                                <div>
                                    <strong>üìÖ Inicio:</strong><br>
                                    {{ evento.fecha_inicio|date:"d/m/Y H:i" }}
                                </div>
                                <div>
                                    <strong>üìç Lugar:</strong><br>
                                    {{ evento.lugar }}
                                </div>
                                <div>
                                    <strong>üë• Cupos:</strong><br>
                                    {{ evento.total_inscritos }}/{{ evento.cupo_maximo }}
                                </div>
                                {% if not evento.es_gratuito %}
                                <div>
                                    <strong>üíµ Costo:</strong><br>
                                    ${{ evento.costo|floatformat:2 }}
                                </div>
                                {% endif %}
                            </div>
                        </div>
                        
                        <!-- Acciones -->
                        <div style="display: flex; flex-direction: column; gap: 0.5rem; min-width: 150px;">
                            <a href="{% url 'eventos:detalle' evento.pk %}" class="btn btn-secondary">
                                Ver Detalle
                            </a>
                            
                            {% if user.puede_gestionar_eventos %}
                                <a href="{% url 'eventos:editar' evento.pk %}" class="btn btn-secondary">
                                    Editar
                                </a>
                                
                                {% if evento.estado == 'BORRADOR' %}
                                    <form method="post" action="{% url 'eventos:publicar' evento.pk %}" style="margin: 0;">
                                        {% csrf_token %}
                                        <button type="submit" class="btn btn-primary" style="width: 100%;">
                                            Publicar
                                        </button>
                                    </form>
                                {% endif %}
                                
                                <a href="{% url 'eventos:duplicar' evento.pk %}" class="btn btn-secondary">
                                    Duplicar
                                </a>
                                
                                {% if user.es_administrador %}
                                    <a href="{% url 'eventos:eliminar' evento.pk %}" class="btn btn-danger">
                                        Eliminar
                                    </a>
                                {% endif %}
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="alert alert-info">
            No hay eventos disponibles en este momento.
            {% if user.puede_gestionar_eventos %}
                <a href="{% url 'eventos:crear' %}">¬øDesea crear uno?</a>
            {% endif %}
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}

