{% extends 'base.html' %}
{% load static %}

{% block title %}Pago con Tarjeta - PRCE{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/simulaciones.css' %}">
{% endblock %}

{% block content %}
<div class="container mt-4 mb-5">
    <div class="row">
        <div class="col-lg-6 offset-lg-3">
            <h2 class="mb-4">üí≥ Pago con Tarjeta</h2>
            
            <!-- Vista Previa de Tarjeta -->
            <div class="card-preview fade-in">
                <div class="card-chip"></div>
                <div class="card-number" id="cardNumberDisplay">‚Ä¢‚Ä¢‚Ä¢‚Ä¢ ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ ‚Ä¢‚Ä¢‚Ä¢‚Ä¢</div>
                <div class="card-details">
                    <div>
                        <small>TITULAR</small>
                        <div id="cardNameDisplay">NOMBRE TITULAR</div>
                    </div>
                    <div>
                        <small>VENCE</small>
                        <div id="cardExpDisplay">MM/AA</div>
                    </div>
                </div>
                <div class="card-icon" id="cardIcon"></div>
            </div>

            <!-- Formulario -->
            <div class="card">
                <div class="card-body">
                    <form method="post" id="cardPaymentForm" class="needs-validation" novalidate>
                        {% csrf_token %}
                        
                        <div class="mb-3">
                            <label for="{{ form.numero_tarjeta.id_for_label }}" class="form-label">N√∫mero de Tarjeta</label>
                            {{ form.numero_tarjeta }}
                            <small class="form-text text-muted">{{ form.numero_tarjeta.help_text }}</small>
                            {% if form.numero_tarjeta.errors %}
                            <div class="invalid-feedback d-block">{{ form.numero_tarjeta.errors.0 }}</div>
                            {% endif %}
                        </div>

                        <div class="mb-3">
                            <label for="{{ form.nombre_titular.id_for_label }}" class="form-label">Nombre del Titular</label>
                            {{ form.nombre_titular }}
                            {% if form.nombre_titular.errors %}
                            <div class="invalid-feedback d-block">{{ form.nombre_titular.errors.0 }}</div>
                            {% endif %}
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="{{ form.fecha_expiracion.id_for_label }}" class="form-label">Fecha de Expiraci√≥n</label>
                                {{ form.fecha_expiracion }}
                                <small class="form-text text-muted">MM/AA</small>
                                {% if form.fecha_expiracion.errors %}
                                <div class="invalid-feedback d-block">{{ form.fecha_expiracion.errors.0 }}</div>
                                {% endif %}
                            </div>
                            
                            <div class="col-md-6 mb-3">
                                <label for="{{ form.cvv.id_for_label }}" class="form-label">CVV</label>
                                {{ form.cvv }}
                                <small class="form-text text-muted">3-4 d√≠gitos</small>
                                {% if form.cvv.errors %}
                                <div class="invalid-feedback d-block">{{ form.cvv.errors.0 }}</div>
                                {% endif %}
                            </div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Tipo de Tarjeta</label>
                            <div>
                                {% for radio in form.tipo_tarjeta %}
                                <div class="form-check form-check-inline">
                                    {{ radio.tag }}
                                    <label class="form-check-label" for="{{ radio.id_for_label }}">
                                        {{ radio.choice_label }}
                                    </label>
                                </div>
                                {% endfor %}
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="{{ form.cuotas.id_for_label }}" class="form-label">Cuotas</label>
                            {{ form.cuotas }}
                        </div>

                        <div class="mb-3">
                            <label for="{{ form.monto.id_for_label }}" class="form-label">Monto</label>
                            {{ form.monto }}
                            {% if form.monto.errors %}
                            <div class="invalid-feedback d-block">{{ form.monto.errors.0 }}</div>
                            {% endif %}
                        </div>

                        <div class="mb-4">
                            <label for="{{ form.notas.id_for_label }}" class="form-label">Notas (Opcional)</label>
                            {{ form.notas }}
                        </div>

                        <div class="alert alert-warning">
                            <i class="fas fa-exclamation-triangle"></i>
                            <strong>Sistema Simulado:</strong> Este es un pago simulado. Puede ingresar cualquier n√∫mero de tarjeta.
                        </div>

                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-primary btn-lg">
                                <i class="fas fa-lock"></i> Procesar Pago - ${{ form.monto.value|default:inscripcion.evento.costo }}
                            </button>
                            <a href="{% url 'pagos:seleccionar_metodo' inscripcion.id %}" class="btn btn-outline-secondary">
                                <i class="fas fa-arrow-left"></i> Cambiar M√©todo
                            </a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/simulaciones.js' %}"></script>
<script>
    // Actualizar preview en tiempo real
    document.addEventListener('DOMContentLoaded', function() {
        const numeroInput = document.getElementById('id_numero_tarjeta');
        const nombreInput = document.getElementById('id_nombre_titular');
        const expInput = document.getElementById('id_fecha_expiracion');
        
        if (numeroInput) {
            numeroInput.addEventListener('input', function() {
                const display = document.getElementById('cardNumberDisplay');
                if (display) {
                    display.textContent = this.value || '‚Ä¢‚Ä¢‚Ä¢‚Ä¢ ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ ‚Ä¢‚Ä¢‚Ä¢‚Ä¢';
                }
            });
        }
        
        if (nombreInput) {
            nombreInput.addEventListener('input', function() {
                const display = document.getElementById('cardNameDisplay');
                if (display) {
                    display.textContent = this.value.toUpperCase() || 'NOMBRE TITULAR';
                }
            });
        }
        
        if (expInput) {
            expInput.addEventListener('input', function() {
                const display = document.getElementById('cardExpDisplay');
                if (display) {
                    display.textContent = this.value || 'MM/AA';
                }
            });
        }
    });
</script>
{% endblock %}
