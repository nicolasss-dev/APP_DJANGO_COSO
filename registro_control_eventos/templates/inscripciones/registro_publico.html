{% extends 'base.html' %}
{% load static %}

{% block title %}Eventos Disponibles - PRCE{% endblock %}

{% block page_title %}
<div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;">
    <div>
        <h1>Eventos Disponibles</h1>
        <p style="color: #6c757d; margin: 0.5rem 0 0;">Inscr√≠base a nuestros eventos p√∫blicos</p>
    </div>
    {% if user.is_authenticated %}
    <a href="{% url 'dashboard:index' %}" class="btn btn-secondary">
        Volver al Dashboard
    </a>
    {% endif %}
</div>
{% endblock %}

{% block content %}
<!-- Informaci√≥n General -->
<div class="card" style="margin-bottom: 2rem;">
    <div class="card-body">
        <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;">
            <div>
                <h3 style="margin: 0;">{{ total_eventos }} Evento{{ total_eventos|pluralize }} Disponible{{ total_eventos|pluralize }}</h3>
                <p style="color: #6c757d; margin: 0.5rem 0 0;">Seleccione un evento para inscribirse</p>
            </div>
            {% if not user.is_authenticated %}
            <div style="text-align: right;">
                <p style="margin: 0; color: #6c757d;">¬øYa tiene cuenta?</p>
                <a href="{% url 'usuarios:login' %}" class="btn btn-outline">
                    Iniciar Sesi√≥n
                </a>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- Lista de Eventos -->
{% if eventos %}
<div style="display: grid; gap: 1.5rem;">
    {% for evento in eventos %}
    <div class="card">
        <div class="card-body">
            <!-- Header del Evento -->
            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem; flex-wrap: wrap; gap: 1rem;">
                <div style="flex: 1;">
                    <h2 style="margin: 0 0 0.5rem;">{{ evento.nombre }}</h2>
                    <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                        <span class="badge badge-info">{{ evento.tipo_evento }}</span>
                        {% if evento.es_gratuito %}
                            <span class="badge badge-success">Gratuito</span>
                        {% else %}
                            <span class="badge badge-warning">${{ evento.costo|floatformat:0 }}</span>
                        {% endif %}
                        {% if evento.genera_certificado %}
                            <span class="badge" style="background-color: #9b59b6; color: white;">Genera Certificado</span>
                        {% endif %}
                    </div>
                </div>
                <div style="text-align: right;">
                    <div style="font-size: 1.5rem; font-weight: bold; color: #3498db;">
                        {{ evento.cupos_disponibles }}
                    </div>
                    <div style="color: #6c757d; font-size: 0.875rem;">
                        de {{ evento.cupo_maximo }} cupos
                    </div>
                </div>
            </div>
            
            <!-- Descripci√≥n -->
            <p style="color: #6c757d; margin-bottom: 1rem;">
                {{ evento.descripcion|truncatewords:50 }}
            </p>
            
            <!-- Detalles -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 1rem; padding: 1rem; background-color: #f5f5f5;">
                <div>
                    <strong>üìÖ Fecha de Inicio:</strong><br>
                    <span style="color: #6c757d;">{{ evento.fecha_inicio|date:"d/m/Y" }}</span>
                </div>
                <div>
                    <strong>‚è∞ Hora:</strong><br>
                    <span style="color: #6c757d;">{{ evento.fecha_inicio|date:"H:i" }}</span>
                </div>
                <div>
                    <strong>üìç Lugar:</strong><br>
                    <span style="color: #6c757d;">{{ evento.lugar }}</span>
                </div>
                <div>
                    <strong>üìä Sesiones:</strong><br>
                    <span style="color: #6c757d;">{{ evento.numero_sesiones }} sesi√≥n{{ evento.numero_sesiones|pluralize:"es" }}</span>
                </div>
            </div>
            
            <!-- Acciones -->
            <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                <a href="{% url 'inscripciones:registro_publico_evento' evento.pk %}" class="btn btn-primary">
                    Inscribirse Ahora
                </a>
                <a href="{% url 'eventos:detalle' evento.pk %}" class="btn btn-outline">
                    Ver Detalles
                </a>
            </div>
        </div>
    </div>
    {% endfor %}
</div>

<!-- Paginaci√≥n (placeholder para futuro) -->
{% if eventos|length > 10 %}
<div style="margin-top: 2rem; text-align: center;">
    <p style="color: #6c757d;">Mostrando {{ eventos|length }} eventos</p>
</div>
{% endif %}

{% else %}
<!-- No hay eventos -->
<div class="card">
    <div class="card-body" style="text-align: center; padding: 3rem 1rem;">
        <div style="font-size: 3rem; color: #dee2e6; margin-bottom: 1rem;">üìÖ</div>
        <h3 style="color: #6c757d;">No hay eventos disponibles</h3>
        <p style="color: #6c757d; margin-bottom: 2rem;">
            En este momento no hay eventos publicados con cupos disponibles.
            Por favor vuelva m√°s tarde.
        </p>
        {% if not user.is_authenticated %}
        <div style="margin-top: 2rem; padding-top: 2rem; border-top: 1px solid #dee2e6;">
            <p style="color: #6c757d;">¬øYa tiene cuenta?</p>
            <a href="{% url 'usuarios:login' %}" class="btn btn-primary">
                Iniciar Sesi√≥n
            </a>
        </div>
        {% endif %}
    </div>
</div>
{% endif %}

<!-- Informaci√≥n adicional -->
<div class="card" style="margin-top: 2rem;">
    <div class="card-header">
        <h3>¬øC√≥mo funciona la inscripci√≥n?</h3>
    </div>
    <div class="card-body">
        <ol style="line-height: 2;">
            <li>Seleccione el evento de su inter√©s haciendo clic en "Inscribirse Ahora"</li>
            <li>Complete el formulario con sus datos personales</li>
            <li>Si el evento tiene costo, proceda con el pago</li>
            <li>Recibir√° un correo de confirmaci√≥n con su c√≥digo QR</li>
            <li>Presente su c√≥digo QR el d√≠a del evento para registrar asistencia</li>
        </ol>
        <div style="margin-top: 1rem; padding: 1rem; background-color: #d1ecf1; border-left: 4px solid #0c5460;">
            <small style="color: #0c5460;">
                <strong>Nota:</strong> Para eventos que generan certificado, debe cumplir con el porcentaje m√≠nimo de asistencia indicado.
            </small>
        </div>
    </div>
</div>
{% endblock %}

