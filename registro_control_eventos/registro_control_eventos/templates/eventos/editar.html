{% extends 'base.html' %}
{% load static %}

{% block title %}Editar Evento - PRCE{% endblock %}

{% block page_title %}
<h1>Editar Evento: {{ evento.nombre }}</h1>
{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header">
        <h2>Información del Evento</h2>
    </div>
    <div class="card-body">
        <form method="post" enctype="multipart/form-data">
            {% csrf_token %}
            
            <!-- Información Básica -->
            <h3 style="margin-bottom: 1.5rem; padding-bottom: 0.5rem; border-bottom: 2px solid #dee2e6;">
                Información Básica
            </h3>
            
            <div class="form-group">
                <label for="id_nombre" class="form-label">Nombre del evento *</label>
                {{ form.nombre }}
                {% if form.nombre.errors %}
                <span class="form-error">{{ form.nombre.errors.0 }}</span>
                {% endif %}
            </div>
            
            <div class="form-group">
                <label for="id_descripcion" class="form-label">Descripción *</label>
                {{ form.descripcion }}
                {% if form.descripcion.errors %}
                <span class="form-error">{{ form.descripcion.errors.0 }}</span>
                {% endif %}
            </div>
            
            <div class="form-group">
                <label for="id_tipo_evento" class="form-label">Tipo de Evento *</label>
                {{ form.tipo_evento }}
                {% if form.tipo_evento.errors %}
                <span class="form-error">{{ form.tipo_evento.errors.0 }}</span>
                {% endif %}
            </div>
            
            <!-- Fechas y Horarios -->
            <h3 style="margin: 2rem 0 1.5rem; padding-bottom: 0.5rem; border-bottom: 2px solid #dee2e6;">
                Fechas y Horarios
            </h3>
            
            {% if evento.inscripciones.filter(estado='CONFIRMADA').exists %}
            <div class="alert alert-warning">
                <strong>Advertencia:</strong> Este evento tiene inscripciones confirmadas. 
                Si modifica las fechas, se enviará una notificación automática a todos los inscritos.
            </div>
            {% endif %}
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                <div class="form-group">
                    <label for="id_fecha_inicio" class="form-label">Fecha y Hora de Inicio *</label>
                    {{ form.fecha_inicio }}
                    {% if form.fecha_inicio.errors %}
                    <span class="form-error">{{ form.fecha_inicio.errors.0 }}</span>
                    {% endif %}
                </div>
                
                <div class="form-group">
                    <label for="id_fecha_fin" class="form-label">Fecha y Hora de Fin *</label>
                    {{ form.fecha_fin }}
                    {% if form.fecha_fin.errors %}
                    <span class="form-error">{{ form.fecha_fin.errors.0 }}</span>
                    {% endif %}
                </div>
            </div>
            
            <!-- Ubicación -->
            <h3 style="margin: 2rem 0 1.5rem; padding-bottom: 0.5rem; border-bottom: 2px solid #dee2e6;">
                Ubicación
            </h3>
            
            <div class="form-group">
                <label for="id_lugar" class="form-label">Lugar *</label>
                {{ form.lugar }}
                {% if form.lugar.errors %}
                <span class="form-error">{{ form.lugar.errors.0 }}</span>
                {% endif %}
            </div>
            
            <div class="form-group">
                <label for="id_direccion" class="form-label">Dirección</label>
                {{ form.direccion }}
                {% if form.direccion.errors %}
                <span class="form-error">{{ form.direccion.errors.0 }}</span>
                {% endif %}
            </div>
            
            <!-- Capacidad y Costo -->
            <h3 style="margin: 2rem 0 1.5rem; padding-bottom: 0.5rem; border-bottom: 2px solid #dee2e6;">
                Capacidad y Costo
            </h3>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                <div class="form-group">
                    <label for="id_cupo_maximo" class="form-label">Cupo Máximo *</label>
                    {{ form.cupo_maximo }}
                    {% if form.cupo_maximo.errors %}
                    <span class="form-error">{{ form.cupo_maximo.errors.0 }}</span>
                    {% endif %}
                    <small class="form-help">Inscritos actualmente: {{ evento.total_inscritos }}</small>
                </div>
                
                <div class="form-group">
                    <label for="id_costo" class="form-label">Costo de Inscripción *</label>
                    {{ form.costo }}
                    {% if form.costo.errors %}
                    <span class="form-error">{{ form.costo.errors.0 }}</span>
                    {% endif %}
                </div>
            </div>
            
            <!-- Imagen Promocional -->
            <h3 style="margin: 2rem 0 1.5rem; padding-bottom: 0.5rem; border-bottom: 2px solid #dee2e6;">
                Imagen Promocional
            </h3>
            
            {% if evento.imagen_banner %}
            <div style="margin-bottom: 1rem;">
                <img src="{{ evento.imagen_banner.url }}" alt="Banner actual" style="max-width: 400px; height: auto; border: 1px solid #dee2e6;">
                <br>
                <small style="color: #6c757d;">Banner actual</small>
            </div>
            {% endif %}
            
            <div class="form-group">
                <label for="id_imagen_banner" class="form-label">Cambiar Banner</label>
                {{ form.imagen_banner }}
                {% if form.imagen_banner.errors %}
                <span class="form-error">{{ form.imagen_banner.errors.0 }}</span>
                {% endif %}
                <small class="form-help">JPG/PNG, máx 2MB</small>
            </div>
            
            <!-- Estado -->
            <h3 style="margin: 2rem 0 1.5rem; padding-bottom: 0.5rem; border-bottom: 2px solid #dee2e6;">
                Estado del Evento
            </h3>
            
            <div class="form-group">
                <label for="id_estado" class="form-label">Estado *</label>
                {{ form.estado }}
                {% if form.estado.errors %}
                <span class="form-error">{{ form.estado.errors.0 }}</span>
                {% endif %}
            </div>
            
            <!-- Configuraciones Adicionales -->
            <h3 style="margin: 2rem 0 1.5rem; padding-bottom: 0.5rem; border-bottom: 2px solid #dee2e6;">
                Configuraciones Adicionales
            </h3>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                <div class="form-group">
                    <label for="id_numero_sesiones" class="form-label">Número de Sesiones *</label>
                    {{ form.numero_sesiones }}
                    {% if form.numero_sesiones.errors %}
                    <span class="form-error">{{ form.numero_sesiones.errors.0 }}</span>
                    {% endif %}
                </div>
                
                <div class="form-group">
                    <label for="id_porcentaje_asistencia_minimo" class="form-label">Asistencia Mínima para Certificado *</label>
                    {{ form.porcentaje_asistencia_minimo }}
                    {% if form.porcentaje_asistencia_minimo.errors %}
                    <span class="form-error">{{ form.porcentaje_asistencia_minimo.errors.0 }}</span>
                    {% endif %}
                </div>
            </div>
            
            <div class="form-group">
                <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                    {{ form.genera_certificado }}
                    <span>Genera certificado de participación</span>
                </label>
            </div>
            
            <div class="form-group">
                <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                    {{ form.requiere_aprobacion }}
                    <span>Las inscripciones requieren aprobación</span>
                </label>
            </div>
            
            <div style="display: flex; gap: 1rem; margin-top: 2rem;">
                <button type="submit" class="btn btn-primary">
                    Actualizar Evento
                </button>
                <a href="{% url 'eventos:detalle' evento.pk %}" class="btn btn-secondary">
                    Cancelar
                </a>
            </div>
        </form>
    </div>
</div>

<div class="card">
    <div class="card-header">
        <h3>Información de Auditoría</h3>
    </div>
    <div class="card-body">
        <table class="table">
            <tr>
                <th>Creado por:</th>
                <td>{{ evento.creado_por.get_full_name|default:evento.creado_por.username }}</td>
            </tr>
            <tr>
                <th>Fecha de creación:</th>
                <td>{{ evento.fecha_creacion|date:"d/m/Y H:i" }}</td>
            </tr>
            {% if evento.modificado_por %}
            <tr>
                <th>Última modificación por:</th>
                <td>{{ evento.modificado_por.get_full_name|default:evento.modificado_por.username }}</td>
            </tr>
            <tr>
                <th>Fecha de modificación:</th>
                <td>{{ evento.fecha_modificacion|date:"d/m/Y H:i" }}</td>
            </tr>
            {% endif %}
        </table>
    </div>
</div>
{% endblock %}

